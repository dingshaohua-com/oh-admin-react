`VerificationModule`（验证模块）在后端架构中扮演的是一个 **“临时凭证管理中心”** 或 **“身份核验官”** 的角色。

它不负责管理用户信息（那是 UserModule 的事），也不负责发放长期的登录 Token（那是 AuthModule 的事）。**它的核心任务只有一个：证明“现在的你”确实是“你声称的那个账号的所有者”。**

以下是 `VerificationModule` 一般用来做的具体事情，按功能和场景分类：

### 1. 核心职责（它实际干的工作）

不管上层业务是什么，这个模块底层主要做这 4 件事：

1.  **生成凭证 (Generation)**: 生成随机数字（如 `123456`）、随机字符串或加密 Token。
2.  **存储凭证 (Storage)**: 将凭证存入 Redis，设置短暂的过期时间（TTL，如 5 分钟）。
3.  **发送凭证 (Delivery)**: 调用 `SmsModule` 或 `MailModule` 把凭证发给用户。
4.  **校验凭证 (Validation)**: 接收用户输入的码，对比 Redis 里的值，并返回 True/False。

---

### 2. 具体业务场景（它服务谁）

你可以把 `VerificationModule` 想象成一个公共服务部门，其他模块都要来找它办事：

#### A. 注册与登录 (Auth)
*   **手机号/邮箱注册**：验证用户填写的手机/邮箱是否属于本人。
*   **验证码登录 (SMS/OTP Login)**：免密码，直接用验证码登录。
*   **MFA / 2FA (双重认证)**：密码输对了还不够，需要再校验一次动态验证码。

#### B. 账号安全设置 (User Security)
*   **找回密码 / 重置密码**：只有验证了验证码，才允许调用“修改密码接口”。
*   **更换绑定手机/邮箱**：
    *   *步骤1*：验证“旧”手机号（证明是你本人在操作）。
    *   *步骤2*：验证“新”手机号（证明新手机号可用且属于你）。
*   **注销账号**：防止恶意删除，通常需要最后一次验证码确认。

#### C. 敏感操作风控 (Risk Control)
*   **资金变动**：提现、转账、支付确认（类似于银行的“输入验证码完成支付”）。
*   **查看敏感信息**：例如查看完整的 API Key、查看备份助记词等。

---

### 3. 安全与限流职责（它还要防什么）

除了发和收，这个模块通常还承担着 **“防火墙”** 的作用，防止短信/邮件接口被刷爆（帮你省钱）：

1.  **频率限制 (Rate Limiting)**：
    *   限制同一个手机号 1 分钟只能发 1 次。
    *   限制同一个 IP 1 天只能发 10 次。
2.  **图形验证码 (Captcha)**：
    *   在发送短信之前，先要求用户输入图形验证码（滑块、点选），防止脚本自动刷短信接口。
3.  **错误次数限制**：
    *   一个验证码如果输错 5 次，直接作废，防止暴力破解。

---

### 4. 代码层面的数据流向示例

**场景：用户点击“忘记密码”**

1.  **前端** -> `POST /verification/send` (body: { email: "test@xx.com", type: "FORGOT_PASS" })
2.  **后端 (VerificationModule)**:
    *   生成 `8888`。
    *   存入 Redis: `verify:forgot_pass:test@xx.com` = `8888`。
    *   发邮件给用户。
3.  **前端** -> 用户收到邮件，输入 `8888` 和 `新密码` -> `POST /auth/reset-password`。
4.  **后端 (AuthModule)**:
    *   接收请求。
    *   **调用 `VerificationService.verifyCode("test@xx.com", "8888", "FORGOT_PASS")`**。
    *   如果校验通过 -> 修改数据库密码 -> 删除 Redis key。
    *   如果校验失败 -> 驳回请求。

### 总结

`VerificationModule` 就是用来 **“管理短时效、一次性验证逻辑”** 的地方。

如果不把它独立出来，你的代码里会到处充斥着 `redis.set`, `redis.get`, `if (code !== input)` 这样的重复逻辑，非常难维护。